{% extends '_mybase.html' %}

{% block scripts %}
    <script src="{{ url_for('static',filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static',filename='js/jquery-1.12.4.min.js') }}"></script>
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function () {
            $("button#update").click(function(){
                if(window.confirm("确认更新数据吗?")==false)
                    return false;
            });
        });
    </script>
{% endblock scripts %}

{% block body %}
    {{ super() }}

    <h3>树莓派测试统计</h3>

    <table border="1">
        <tr>
            <th>&nbsp;工厂&nbsp;</th>
            <th>&nbsp;测试总数&nbsp;</th>
            <th>&nbsp;成功数量&nbsp;</th>
            <th>&nbsp;失败数量&nbsp;</th>
            <th>&nbsp;成功率&nbsp;</th>
            <th>&nbsp;最近上传时间&nbsp;</th>
            <th>&nbsp;最近更新时间&nbsp;</th>
            <th>&nbsp;操作&nbsp;</th>
        </tr>

        {% for data in datas %}
            <tr>
                <td>&nbsp;{{ data.fname }}&nbsp;</td>
                <td>&nbsp;{{ data.total }}&nbsp;</td>
                <td>&nbsp;{{ data.success }}&nbsp;</td>
                <td>&nbsp;{{ data.failed }}&nbsp;</td>
                <td>&nbsp;{{ data.srate }}&nbsp;</td>
                <td>&nbsp;{{ data.last_upload_time }}&nbsp;</td>
                <td>&nbsp;{{ data.last_update_time }}&nbsp;</td>
                <td>
                    &nbsp;
                    <form style="display: inline" action="{{ url_for('blue_rasp.vf_uploadrecord') }}" method="post">
                        <input type="hidden" name="fcode" value={{data.fcode}}>
                        <button type="submit">查看上传记录</button>
                    </form>
                    &nbsp;
                    <form style="display: inline" action="{{ url_for('blue_rasp.vf_testdata', clearsearchsession=1) }}" method="post">
                        <input type="hidden" name="fcode" value={{data.fcode}}>
                        <button type="submit">查看历史数据</button>
                    </form>
                    &nbsp;
                    <form style="display: inline" action="{{ url_for('blue_rasp.cmd_update_stat', fcode=data.fcode) }}" method="post"><button id="update" type="submit"
                    {% if need_update(data.fcode) %}
                        style="color:green"
                    {% else %}
                        style="color:red"
                    {% endif %}
                    >更新数据</button></form>
                    &nbsp;
                </td>
            </tr>
        {% endfor %}
    </table>
    <br>

    {% if current_user.id >= 100 %}
        <form style="display: inline" action="{{ url_for('blue_rasp.vf_uploadrecord') }}" method="post">
            <input type="hidden" name="fcode" value=0>
            <button type="submit">查看全部厂家上传记录</button>
        </form> |
        <form style="display: inline" action="{{ url_for('blue_rasp.vf_testdata', clearsearchsession=1) }}" method="post">
            <input type="hidden" name="fcode" value=0>
            <button type="submit">查看全部厂家历史数据</button>
        </form> |
        <form style="display: inline" action="{{ url_for('blue_rasp.cmd_update_stat', fcode=0) }}" method="post"><button id="update" type="submit">更新全部厂家数据</button></form> |
    {% endif %}
    <a href="{{ url_for('blue_rasp.vf_stat') }}">刷新</a> |
    <a href="{{ url_for('blue_main.vf_index') }}">返回</a>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <p style="color:red">{{ message }}</p>
            {% endfor %}
        {% endif %}
    {% endwith %}

{% endblock body %}

